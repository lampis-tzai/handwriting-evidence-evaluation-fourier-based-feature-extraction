# Handwriting Evidence Evaluation: Fourier based Feature Extraction
This repository contains a demonstration of the work titled "Bayesian MANOVA for Handwriting Evidence Evaluation: Fourier-Based Feature Extraction." It includes an example of step-by-step image preprocessing and the implementation of Fourier series to extract Fourier coefficients as features. Additionally, it covers Bayesian modeling and Bayes factor calculation to support hypothesis testing.


Forensic document examiners frequently need to cope with situations involving handwritten documents whose writership is questioned. Consider the following scenario involving an handwritten document whose origin is contested. Written material originating from an individual who is suspected to be the actual source of the disputed item is collected and examined for comparative purposes. The available evidence should be evaluated under a set of propositions in a given framework of information put forward by opposing parties (i.e., the prosecutor and the defense attorneys, respectively) at trial. The propositions of interest can therefore be formulated as follows:
 \begin{itemize}
$H_1$: the person of interest (PoI) is the writer of the questioned document;
$H_2$: the person of interest (PoI) is not the writer of the questioned document.
\end{itemize}

First of all, $n_1>0$ characters are selected from the 
anonymous manuscript document; these are referred to as questioned material. Then, $n_2>0$ characters are selected from the handwritten material originating from the person of interest; these are referred to as control material or reference material. Measurements (i.e., Fourier coefficients and the surface size) made on questioned and control material are denoted by: $\mathbf{y}_{w...} = (\mathbf{y}_{w\ell j\bullet},w=1,2,\;\ell=1,..L,\;j=1,...,n_{w\ell})$, with $\mathbf{y}_1$ denoting the measurements made on the questioned material and $\mathbf{y}_2$ the measurements made on the control material. Thus, it is crucial to provide information about the value of the evidence $(\mathbf{y}_1,\mathbf{y}_2)$ in support of the competing propositions. This is given by the ratio of the marginal likelihoods under the competing propositions:

$$
     BF=\frac{m(\mathbf{y}_1,\mathbf{y}_2|H_1)}{m(\mathbf{y}_1,\mathbf{y}_2|H_2)} 
    = \frac{m(\mathbf{y}_1,\mathbf{y}_2|H_1)}{m(\mathbf{y}_1|H_2)m(\mathbf{y}_2|H_2)}
$$

The marginal likelihoods in BF can be obtained using the same probabilistic model that will be adopted to describe the handwriting data. Specifically, the marginal likelihood in the numerator, $m(\mathbf{y}_1,\mathbf{y}_2|H_1)$, is calculated assuming that all observations of the combined dataset $\{\mathbf{y}_1,\mathbf{y}_2\}$ have a common parameter vector, since it is assumed that $H_1$ holds, so that data originate from the same writer. On the other hand, if $H_2$ holds and the competing material originate from different writers, the measurements $\mathbf{y}_1$ and $\mathbf{y}_2$ can be considered independent. Consequently, the marginal likelihood $m(\mathbf{y}_1,\mathbf{y}_2|H_2)$ can be obtained as the product of two independent marginal likelihoods, $m(\mathbf{y}_1|H_2)$ and $m(\mathbf{y}_2|H_2)$, respectively. The latter marginal likelihoods are calculated using the same probabilistic model, but by fitting this last one separately for each dataset $\mathbf{y}_1$ and $\mathbf{y}_2$ and by taking different parameters vectors. Note that the implemented Bayes Factor assumes independence between the questioned and control material under $H_2$. This assumption implies that possible disguised behavior is not considered.

In this work, two different modelling approaches are analyzed and compared. First, a Bayesian Normal is implemented. The distribution of available data is taken to be a multivariate Normal. Three different prior specifications are used: 
(a) the usual conjugate prior and (b)  a prior with similar setup where the variance-covariance matrix is independent of the mean parameter vector and (c) a prior with covariance decomposition where the within-writer variability following LogNormal-LKJ distribution. Under this model, the character-level variability is not modelled, since one common variance-covariance matrix is considered for all observed characters. Therefore, all measurements are evaluated jointly without distinction by character type. In order to take into consideration the impact of this further layer of variability, the models has also been fitted for each character separately. Secondly, a Bayesian MANOVA model was proposed. Under this second model, the type of characters are taken as dummy indicator variables (with corner-point representation). Similarly to the first modelling approach, a conjugate prior specification (Section~\ref{bayesian_manova_conjugate}), a hierarchical Normal-Inverse-Wishart prior specification and Normal-LogNormal-LKJ prior specification have been considered. Since the marginal likelihoods that are needed to calculate the Bayes factor are not always available in analytical form, Bridge sampling estimation is considered.
